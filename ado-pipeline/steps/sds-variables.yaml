parameters:
  - name: environment
    type: string

steps:

  - template: templates/Azure/Common/get-service-connection-details.yaml@templates
    parameters:
      subscriptionName: "DTS-SHAREDSERVICES-${{ parameters.environment }}"

  - powershell: |
      $sds_credentails = [PSCustomObject]@{
        sds_client_id      = "$($env:sds_client_id)"
          sds_client_secret  = "$($env:sds_client_secret)"
          sds_subcription_id = "$($env:sds_subcription_id)"
          sds_tenant_id      = "$($env:sds_tenant_id)"
      }

      $sds_credentailsJson = $sds_credentails | ConvertTo-Json -Compress -Depth 100
      $sds_credentailsJson = $sds_credentailsJson -replace "`"","\`""

      $variableStr = " -var sds_credentails=$sds_credentailsJson "

      Write-Host "$variableStr"
      echo "##vso[task.setvariable variable=sdsVars;output=true]${variables}"
    displayName: 'Set SDS TF Variables'
    name: extraVars
    env:
      sds_client_id: $(serviceConnection.ARM_CLIENT_ID) 
      sds_client_secret: $(serviceConnection.ARM_CLIENT_SECRET) 
      sds_subcription_id: $(serviceConnection.ARM_SUBSCRIPTION_ID) 
      sds_tenant_id: $(serviceConnection.ARM_TENANT_ID) 

   