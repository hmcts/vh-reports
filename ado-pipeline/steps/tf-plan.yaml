parameters:
  - name: subscription
    type: string
  - name: workingDirectory
    type: string
  - name: tfVariables
    type: string
  - name: environment
    type: string

steps:

  - template: sds-variables.yaml
    parameters:
      environment: var.environment

  - task: TerraformCLI@0
    displayName: Terraform plan
    inputs:
      command: plan
      workingDirectory: ${{ parameters.workingDirectory }}
      environmentServiceName: ${{ parameters.subscription }}
      commandOptions: '-var-file=${{ parameters.tfVariables }} -out=$(System.DefaultWorkingDirectory)/plans/${{ parameters.environment }}.tfplan $(extraVars.sdsVars) '
